<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.1.1">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha256-wiz7ZSCn/btzhjKDQBms9Hx4sSeUYsDrTLg7roPstac=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"www.birdlet.github.io","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.19.1","exturl":false,"sidebar":{"position":"right","display":"post","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"gitalk","storage":true,"lazyload":false,"nav":null,"activeClass":"gitalk"},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="My company are now using a docking engine which requires MOL2 as input. Since I use rdkit alot, I want to use rdkit to save mol2 file, while rdkit doesn’t support Tripos MOL2 format in current releas">
<meta property="og:type" content="article">
<meta property="og:title" content="Save MOL2 file from RDkit Mol">
<meta property="og:url" content="https://www.birdlet.github.io/2019/10/03/rdkit_to_mol2/index.html">
<meta property="og:site_name" content="Life is Worth Living">
<meta property="og:description" content="My company are now using a docking engine which requires MOL2 as input. Since I use rdkit alot, I want to use rdkit to save mol2 file, while rdkit doesn’t support Tripos MOL2 format in current releas">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2019-10-03T14:28:00.000Z">
<meta property="article:modified_time" content="2024-02-18T06:12:27.816Z">
<meta property="article:author" content="Birdlet">
<meta property="article:tag" content="cheminfomatics">
<meta property="article:tag" content="rdkit">
<meta property="article:tag" content="mol2">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://www.birdlet.github.io/2019/10/03/rdkit_to_mol2/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"https://www.birdlet.github.io/2019/10/03/rdkit_to_mol2/","path":"2019/10/03/rdkit_to_mol2/","title":"Save MOL2 file from RDkit Mol"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Save MOL2 file from RDkit Mol | Life is Worth Living</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Life is Worth Living</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="home fa-fw"></i>Home</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="user fa-fw"></i>About</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="tags fa-fw"></i>Tags</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="archive fa-fw"></i>Archives</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#mol2-atom-and-bond-types"><span class="nav-number">1.</span> <span class="nav-text"> MOL2 atom and bond types</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#mol2-format"><span class="nav-number">2.</span> <span class="nav-text"> MOL2 format</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3d-coordinates-and-gastiger-charge-support"><span class="nav-number">3.</span> <span class="nav-text"> 3D coordinates and Gastiger charge support</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#future-plan"><span class="nav-number">4.</span> <span class="nav-text"> Future plan</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Birdlet</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">17</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">31</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/birdlet" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;birdlet" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:dk_dingkang@126.com" title="E-Mail → mailto:dk_dingkang@126.com" rel="noopener me" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="https://www.birdlet.github.io/2019/10/03/rdkit_to_mol2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Birdlet">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Life is Worth Living">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="Save MOL2 file from RDkit Mol | Life is Worth Living">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Save MOL2 file from RDkit Mol
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2019-10-03 22:28:00" itemprop="dateCreated datePublished" datetime="2019-10-03T22:28:00+08:00">2019-10-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-02-18 14:12:27" itemprop="dateModified" datetime="2024-02-18T14:12:27+08:00">2024-02-18</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<p>My company are now using a docking engine which requires MOL2 as input. Since I use rdkit alot, I want to use rdkit to save mol2 file, while rdkit doesn’t support Tripos MOL2 format in current release. I don’t want to move to OpenBabel or other packages because I’m lazy ;P. So how about write one MOL2 writer?</p>
<p>I have found many email or issue of rdkit, and I found a pull request <a target="_blank" rel="noopener" href="https://github.com/rdkit/rdkit/pull/415">https://github.com/rdkit/rdkit/pull/415</a> after I write this script (Sad!). When I wrote these script, I haven’t notict this pull request, but I have read MOL2 scripts of UCSF Chimera and an introduction for MOL2 format. Chimera has many internal atom types which is perfectly matching MOL2 supported atom types, while rdkit don’t. For example, the amide bond. If I directly write bond type of amide bond, most MOL2 reader take this a rotatable single bond… Thus the only solution is use SMARTS pattern matching to assign MOL2 atom types.</p>
<span id="more"></span>
<h2 id="mol2-atom-and-bond-types"><a class="markdownIt-Anchor" href="#mol2-atom-and-bond-types"></a> MOL2 atom and bond types</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">rdkit2sybyl = &#123;</span><br><span class="line">    <span class="string">&#x27;6SP3False&#x27;</span>: <span class="string">&#x27;C.3&#x27;</span>,    <span class="string">&#x27;6SP2False&#x27;</span>: <span class="string">&#x27;C.2&#x27;</span>,    <span class="string">&#x27;6SPFalse&#x27;</span>: <span class="string">&#x27;C.1&#x27;</span>,      <span class="string">&#x27;6SP2True&#x27;</span>: <span class="string">&#x27;C.ar&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;7SP3False&#x27;</span>: <span class="string">&#x27;N.3&#x27;</span>,    <span class="string">&#x27;7SP3False_4&#x27;</span>: <span class="string">&#x27;N.4&#x27;</span>, </span><br><span class="line">    <span class="string">&#x27;7SP2False&#x27;</span>: <span class="string">&#x27;N.2&#x27;</span>,    <span class="string">&#x27;7SP2False_4&#x27;</span>:<span class="string">&#x27;N.2&#x27;</span>,   <span class="string">&#x27;7SP2True&#x27;</span>: <span class="string">&#x27;N.ar&#x27;</span>,    <span class="string">&#x27;7SP2True_4&#x27;</span>: <span class="string">&#x27;N.ar&#x27;</span>,     </span><br><span class="line">    <span class="string">&#x27;7SP2False_am&#x27;</span>: <span class="string">&#x27;N.am&#x27;</span>,   <span class="string">&#x27;N_pl&#x27;</span>:<span class="string">&#x27;N.pl&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;7SPFalse&#x27;</span>: <span class="string">&#x27;N.1&#x27;</span>,     <span class="string">&#x27;7SPFalse_4&#x27;</span>: <span class="string">&#x27;N.1&#x27;</span>,   </span><br><span class="line">    <span class="string">&#x27;8SP3False&#x27;</span>: <span class="string">&#x27;O.3&#x27;</span>,    <span class="string">&#x27;8SP2False&#x27;</span>: <span class="string">&#x27;O.2&#x27;</span>,    <span class="string">&#x27;8SP2False_co2&#x27;</span>: <span class="string">&#x27;O.co2&#x27;</span>,  </span><br><span class="line">    <span class="string">&#x27;9SP3False&#x27;</span>:  <span class="string">&#x27;F&#x27;</span>,     <span class="string">&#x27;17SP3False&#x27;</span>:<span class="string">&#x27;Cl&#x27;</span>,     <span class="string">&#x27;35SP3False&#x27;</span>: <span class="string">&#x27;Br&#x27;</span>,     <span class="string">&#x27;53SP3False&#x27;</span>: <span class="string">&#x27;I&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;15SP3False&#x27;</span>:<span class="string">&#x27;P.3&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;16SP3False&#x27;</span>:<span class="string">&#x27;S.3&#x27;</span>,    <span class="string">&#x27;16SP2False&#x27;</span>:<span class="string">&#x27;S.2&#x27;</span>,    <span class="comment"># &#x27;16SP2False&#x27;:&#x27;S.O&#x27;,     &#x27;16SP2False&#x27;:&#x27;S.O2&#x27;,</span></span><br><span class="line">    <span class="string">&#x27;1UNSPECIFIEDFalse&#x27;</span>: <span class="string">&#x27;H&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;11SFalse&#x27;</span>: <span class="string">&#x27;Na&#x27;</span>, <span class="string">&#x27;12SFalse&#x27;</span>: <span class="string">&#x27;Mg&#x27;</span>, <span class="string">&#x27;13SFalse&#x27;</span>: <span class="string">&#x27;Al&#x27;</span>, <span class="string">&#x27;19SFalse&#x27;</span>: <span class="string">&#x27;K&#x27;</span>, <span class="string">&#x27;20SFalse&#x27;</span>: <span class="string">&#x27;Ca&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;26SFalse&#x27;</span>: <span class="string">&#x27;Fe&#x27;</span>, <span class="string">&#x27;29SFalse&#x27;</span>: <span class="string">&#x27;Cu&#x27;</span>, <span class="string">&#x27;30SFalse&#x27;</span>: <span class="string">&#x27;Zn&#x27;</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">idx2element = &#123;<span class="number">1</span>:<span class="string">&#x27;H&#x27;</span>, <span class="number">6</span>:<span class="string">&#x27;C&#x27;</span>, <span class="number">7</span>:<span class="string">&#x27;N&#x27;</span>, <span class="number">8</span>:<span class="string">&#x27;O&#x27;</span>, <span class="number">9</span>:<span class="string">&#x27;F&#x27;</span>, <span class="number">15</span>:<span class="string">&#x27;P&#x27;</span>, <span class="number">16</span>:<span class="string">&#x27;S&#x27;</span>,</span><br><span class="line">              <span class="number">11</span>:<span class="string">&#x27;Na&#x27;</span>, <span class="number">12</span>:<span class="string">&#x27;Mg&#x27;</span>, <span class="number">13</span>:<span class="string">&#x27;Al&#x27;</span>, <span class="number">14</span>:<span class="string">&#x27;Si&#x27;</span>, <span class="number">3</span>:<span class="string">&#x27;Li&#x27;</span>, <span class="number">4</span>:<span class="string">&#x27;P&#x27;</span>, <span class="number">5</span>:<span class="string">&#x27;B&#x27;</span>,</span><br><span class="line">              <span class="number">19</span>:<span class="string">&#x27;K&#x27;</span>, <span class="number">20</span>:<span class="string">&#x27;Ca&#x27;</span>, <span class="number">26</span>:<span class="string">&#x27;Fe&#x27;</span>, <span class="number">29</span>:<span class="string">&#x27;Cu&#x27;</span>, <span class="number">30</span>:<span class="string">&#x27;Zn&#x27;</span>,</span><br><span class="line">              <span class="number">17</span>:<span class="string">&#x27;Cl&#x27;</span>, <span class="number">35</span>:<span class="string">&#x27;Br&#x27;</span>, <span class="number">53</span>:<span class="string">&#x27;I&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line">bond2type = &#123;<span class="number">1.0</span>:<span class="string">&#x27;1&#x27;</span>, <span class="number">1.5</span>:<span class="string">&#x27;ar&#x27;</span>, <span class="number">2.0</span>:<span class="string">&#x27;2&#x27;</span>, <span class="number">3.0</span>:<span class="string">&#x27;3&#x27;</span>&#125;</span><br></pre></td></tr></table></figure>
<p>I use a structure like <code>&#123;AtomIdx&#125;&#123;SP?&#125;&#123;IsAromatic&#125;</code> to identify sybyl atom type, like ‘6SP3False’ is a SP3 carboclic carbon. But these kind of symbl is not enough for many special type of atoms, like amide bond and planar amide. I have to use predifined pattern to recognize these special atom type, like:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">amide_smarts = <span class="string">&#x27;[OX1]=CN&#x27;</span></span><br><span class="line">amide_smarts = Chem.MolFromSmarts(amide_smarts)</span><br><span class="line">amide_pl_smarts = <span class="string">&#x27;[#7]-,=[#6]-,=[#7]&#x27;</span></span><br><span class="line">amide_pl_smarts = Chem.MolFromSmarts(amide_pl_smarts)</span><br><span class="line">carboxylate_smarts = <span class="string">&#x27;[#6]C(=O)[O;H,-]&#x27;</span></span><br><span class="line">carboxylate_smarts = Chem.MolFromSmarts(carboxylate_smarts)</span><br></pre></td></tr></table></figure>
<h2 id="mol2-format"><a class="markdownIt-Anchor" href="#mol2-format"></a> MOL2 format</h2>
<p>Detailed MOL2 format are refereced from <a href="">here</a>, or download from <a href="">this link</a>. I decide to use a simple MOL2 format, which means I ignore most parts of MOL2 file, and only preserve <code>@&lt;TRIPOS&gt;MOLECULE</code>, <code>@&lt;TRIPOS&gt;ATOM</code>, <code>@&lt;TRIPOS&gt;BOND</code> and <code>@&lt;TRIPOS&gt;SUBSTRUCTURE</code>. For atoms and bonds, I travese all of them for labeling special atoms and bonds.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># atom_id  atom_name  x  y  z  atom_type  subst_id  subst_name  charge </span></span><br><span class="line">atom_base_str = <span class="string">&#x27;&#123;:&gt;7d&#125; &#123;:&lt;4s&#125;     &#123;:&gt;9.4f&#125; &#123;:&gt;9.4f&#125; &#123;:&gt;9.4f&#125; &#123;:&lt;5s&#125;    &#123;:&gt;2d&#125; &#123;:&gt;3s&#125; &#123;:&gt;9.4f&#125;\n&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># bond_id  origin_atom_id  target_atom_id  bond_type  </span></span><br><span class="line">bond_base_str = <span class="string">&#x27;&#123;:&gt;6d&#125; &#123;:&gt;4d&#125; &#123;:&gt;4d&#125; &#123;:&lt;2s&#125;\n&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">mol_to_mol2_block</span>(<span class="params">mol, mol_name</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Write molecule in MOL2 file as string</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Args:</span></span><br><span class="line"><span class="string">        mol: rdMol, molecule</span></span><br><span class="line"><span class="string">        mol_name: str, molecule name to set as name in mol2 file</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    mol2_blk = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">    mol2_blk += <span class="string">&#x27;@&lt;TRIPOS&gt;MOLECULE\n&#123;&#125;\n&#123;:&lt;3d&#125; &#123;:&lt;3d&#125; 1 0 0\nSMALL\nGASTEIGER\n&#x27;</span>.<span class="built_in">format</span>(</span><br><span class="line">                mol_name, mol.GetNumAtoms(), mol.GetNumBonds())</span><br><span class="line"></span><br><span class="line">    conf = mol.GetConformer(-<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    mol2_blk += <span class="string">&#x27;@&lt;TRIPOS&gt;ATOM\n&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># processing guadinium bonds TODO</span></span><br><span class="line">    <span class="comment"># pass</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># nitrogen trigonal planar </span></span><br><span class="line">    <span class="keyword">if</span> mol.HasSubstructMatch(amide_pl_smarts):</span><br><span class="line">        amide_pl_flag = <span class="literal">True</span>    </span><br><span class="line">        amide_pl_matched_atoms = []</span><br><span class="line">        <span class="keyword">for</span> pair <span class="keyword">in</span> mol.GetSubstructMatches(amide_pl_smarts):</span><br><span class="line">            amide_pl_matched_atoms.extend(pair)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        amide_pl_flag = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># processing amide bonds</span></span><br><span class="line">    <span class="keyword">if</span> mol.HasSubstructMatch(amide_smarts):</span><br><span class="line">        amide_flag = <span class="literal">True</span>    </span><br><span class="line">        amide_matched_atoms = []</span><br><span class="line">        <span class="keyword">for</span> pair <span class="keyword">in</span> mol.GetSubstructMatches(amide_smarts):</span><br><span class="line">            amide_matched_atoms.extend(pair)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        amide_flag = <span class="literal">False</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># processing carboxyllate O</span></span><br><span class="line">    <span class="keyword">if</span> mol.HasSubstructMatch(carboxylate_smarts):</span><br><span class="line">        carboxy_flag = <span class="literal">True</span></span><br><span class="line">        carboxy_matched_atoms = []</span><br><span class="line">        <span class="keyword">for</span> pair <span class="keyword">in</span> mol.GetSubstructMatches(carboxylate_smarts):</span><br><span class="line">            carboxy_matched_atoms.extend(pair)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        carboxy_flag = <span class="literal">False</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># travese all atoms and set atom type</span></span><br><span class="line">    <span class="keyword">for</span> atom <span class="keyword">in</span> mol.GetAtoms():</span><br><span class="line">        <span class="comment">#if atom.GetAtomicNum() != 8: continue</span></span><br><span class="line">        key = <span class="built_in">str</span>(atom.GetAtomicNum()) + <span class="built_in">str</span>(atom.GetHybridization()) + <span class="built_in">str</span>(atom.GetIsAromatic())</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># N.4</span></span><br><span class="line">        <span class="keyword">if</span> atom.GetAtomicNum() == <span class="number">7</span>:</span><br><span class="line">            <span class="keyword">if</span> atom.GetFormalCharge()==<span class="number">1</span>:</span><br><span class="line">                key += <span class="string">&#x27;_4&#x27;</span> <span class="comment"># N.4 and N.pl</span></span><br><span class="line">            <span class="keyword">elif</span> amide_flag:</span><br><span class="line">                <span class="keyword">if</span> atom.GetIdx() <span class="keyword">in</span> amide_matched_atoms:</span><br><span class="line">                    key += <span class="string">&#x27;_am&#x27;</span> <span class="comment"># N.am</span></span><br><span class="line">            <span class="keyword">elif</span> amide_pl_flag:</span><br><span class="line">                <span class="keyword">if</span> atom.GetIdx() <span class="keyword">in</span> amide_pl_matched_atoms:</span><br><span class="line">                    key = <span class="string">&#x27;N_pl&#x27;</span> <span class="comment"># N.pl</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment"># O in CO2</span></span><br><span class="line">        <span class="keyword">if</span> atom.GetAtomicNum() == <span class="number">8</span> <span class="keyword">and</span> carboxy_flag:</span><br><span class="line">            <span class="keyword">if</span> atom.GetIdx() <span class="keyword">in</span> carboxy_matched_atoms:</span><br><span class="line">                key += <span class="string">&#x27;_co2&#x27;</span></span><br><span class="line">        </span><br><span class="line">        atom_id = atom.GetIdx() + <span class="number">1</span></span><br><span class="line">        atom_name = idx2element[atom.GetAtomicNum()]</span><br><span class="line">        coord = conf.GetAtomPosition(atom.GetIdx())</span><br><span class="line">        atom_type = rdkit2sybyl[key]</span><br><span class="line">        subst_id = <span class="number">1</span></span><br><span class="line">        subst_name = <span class="string">&#x27;UNL&#x27;</span></span><br><span class="line">        charge = <span class="number">0.00</span> </span><br><span class="line">        </span><br><span class="line">        mol2_blk += atom_base_str.<span class="built_in">format</span>(atom_id, atom_name, coord.x, coord.y, coord.z,</span><br><span class="line">                            atom_type, subst_id, subst_name, charge)</span><br><span class="line"></span><br><span class="line">    mol2_blk += <span class="string">&#x27;@&lt;TRIPOS&gt;BOND\n&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># traverse all bonds</span></span><br><span class="line">    <span class="keyword">for</span> bond <span class="keyword">in</span> mol.GetBonds():</span><br><span class="line">        bond_id = bond.GetIdx()+<span class="number">1</span></span><br><span class="line">        origin_atom_id = bond.GetBeginAtomIdx()+<span class="number">1</span></span><br><span class="line">        target_atom_id = bond.GetEndAtomIdx()+<span class="number">1</span></span><br><span class="line">        bond_type = bond2type[bond.GetBondTypeAsDouble()]</span><br><span class="line">        <span class="keyword">if</span> amide_flag:</span><br><span class="line">            origin_atom = mol.GetAtomWithIdx(origin_atom_id-<span class="number">1</span>).GetAtomicNum()</span><br><span class="line">            target_atom = mol.GetAtomWithIdx(target_atom_id-<span class="number">1</span>).GetAtomicNum()</span><br><span class="line">            <span class="keyword">if</span> bond.GetBeginAtomIdx() <span class="keyword">in</span> amide_matched_atoms \</span><br><span class="line">                <span class="keyword">and</span> bond.GetEndAtomIdx() <span class="keyword">in</span> amide_matched_atoms \</span><br><span class="line">                <span class="keyword">and</span> (origin_atom == <span class="number">7</span> <span class="keyword">or</span> target_atom == <span class="number">7</span>):</span><br><span class="line">                bond_type = <span class="string">&#x27;am&#x27;</span></span><br><span class="line"></span><br><span class="line">        mol2_blk += bond_base_str.<span class="built_in">format</span>(bond_id, origin_atom_id, target_atom_id, bond_type)</span><br><span class="line">        </span><br><span class="line">    mol2_blk += <span class="string">&#x27;@&lt;TRIPOS&gt;SUBSTRUCTURE\n     1 UNL     1\n&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> mol2_blk</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="3d-coordinates-and-gastiger-charge-support"><a class="markdownIt-Anchor" href="#3d-coordinates-and-gastiger-charge-support"></a> 3D coordinates and Gastiger charge support</h2>
<p>I also found another email of rdkit asking <a target="_blank" rel="noopener" href="https://sourceforge.net/p/rdkit/mailman/message/35461344/">‘writing a Tripos MOL2 file with charges’</a>, and I have tried to add rdkit calculated Gasteiger charges in MOL2 file.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">smi2conf</span>(<span class="params">smiles, charge=<span class="literal">True</span></span>):</span><br><span class="line">    mol = Chem.MolFromSmiles(smiles)</span><br><span class="line">    <span class="keyword">if</span> mol <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">        mol = Chem.AddHs(mol)</span><br><span class="line">        AllChem.EmbedMolecule(mol)</span><br><span class="line">        AllChem.MMFFOptimizeMolecule(mol, maxIters=<span class="number">1000</span>)</span><br><span class="line">        mol.SetProp(<span class="string">&quot;SMILES&quot;</span>, smiles) </span><br><span class="line">        <span class="comment"># compute Gasteiger charges</span></span><br><span class="line">        <span class="keyword">if</span> charge:</span><br><span class="line">            AllChem.ComputeGasteigerCharges(mol)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">    <span class="keyword">return</span> mol</span><br></pre></td></tr></table></figure>
<p>Then add atom charges in MOL2 file:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">mol_to_mol2_block</span>(<span class="params">mol, mol_name</span>):</span><br><span class="line"></span><br><span class="line">    ......</span><br><span class="line"></span><br><span class="line">   <span class="keyword">if</span> mol.HasSubstructMatch(amide_smarts):</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># travese all atoms and set atom type</span></span><br><span class="line">    <span class="keyword">for</span> atom <span class="keyword">in</span> mol.GetAtoms():</span><br><span class="line">        <span class="comment">#if atom.GetAtomicNum() != 8: continue</span></span><br><span class="line">        key = <span class="built_in">str</span>(atom.GetAtomicNum()) + <span class="built_in">str</span>(atom.GetHybridization()) + <span class="built_in">str</span>(atom.GetIsAromatic())</span><br><span class="line">        </span><br><span class="line">        ......</span><br><span class="line">        </span><br><span class="line">        atom_id = atom.GetIdx() + <span class="number">1</span></span><br><span class="line">        atom_name = idx2element[atom.GetAtomicNum()]</span><br><span class="line">        coord = conf.GetAtomPosition(atom.GetIdx())</span><br><span class="line">        atom_type = rdkit2sybyl[key]</span><br><span class="line">        subst_id = <span class="number">1</span></span><br><span class="line">        subst_name = <span class="string">&#x27;UNL&#x27;</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            charge = atom.GetPropsAsDict()[<span class="string">&#x27;_GasteigerCharge&#x27;</span>]</span><br><span class="line">        <span class="keyword">except</span> KeyError:</span><br><span class="line">            charge = <span class="number">0.00</span> </span><br><span class="line"></span><br><span class="line">        ......</span><br></pre></td></tr></table></figure>
<h2 id="future-plan"><a class="markdownIt-Anchor" href="#future-plan"></a> Future plan</h2>
<p>In this script, I have make a function to convert rdkit.Mol to a Tripos MOL2 file format. It support:</p>
<ul>
<li>most atom types and bond types</li>
<li>three major parts of MOL2 file</li>
<li>3D conformation calculation</li>
<li>Gasteiger charge</li>
</ul>
<p>There are still many unsupported features and weakness:</p>
<ul>
<li>some atom types, including <code>S.O</code>, <code>S.O2</code> and many metal ions</li>
<li>time consuming in conformation generation with metal ions (if input is SMILES)</li>
<li>each atom types require manual recording</li>
</ul>
<p>It seems working fine in a small sample of drug-like molecules, you can download all code <a href="/picture/smi2mol2.py">here</a>. The scripts of <a target="_blank" rel="noopener" href="https://github.com/rdkit/rdkit/pull/415"># 415</a> is much clever and stable then mine, I shall update my scrips and test in more solid samples, like ZINC drug-like as the metioned in <a target="_blank" rel="noopener" href="https://github.com/rdkit/rdkit/pull/415"># 415</a>. This pull request has been developed almost 4 years, since the developer is busy for his work, it might stopped there and integrated in <code>rdkit.Contrib</code>… I hope I can help to contribute some codes for debuging it.</p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/cheminfomatics/" rel="tag"># cheminfomatics</a>
              <a href="/tags/rdkit/" rel="tag"># rdkit</a>
              <a href="/tags/mol2/" rel="tag"># mol2</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2019/10/02/py3dmol_example/" rel="prev" title="py3Dmol in Jupyter">
                  <i class="fa fa-angle-left"></i> py3Dmol in Jupyter
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2024/02/12/Psi4_Antechamber_RESP/" rel="next" title="Psi4 + Antechamber进行RESP电荷拟合">
                  Psi4 + Antechamber进行RESP电荷拟合 <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    <div class="comments gitalk-container"></div>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">
<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2017-2024</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Birdlet</span>
  </div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/pisces/" rel="noopener" target="_blank">NexT.Pisces</a>
  </div>

<div> Visited <span id="busuanzi_value_site_pv"></span> | Visitors <span id="busuanzi_value_site_uv"></span>  </div>

    </div>
  </footer>

  
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  






  




  

  <script class="next-config" data-name="enableMath" type="application/json">false</script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.9/katex.min.css" integrity="sha256-UF1fgpAiu3tPJN/uCqEUHNe7pnr+QR0SQDNfgglgtcM=" crossorigin="anonymous">


<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/gitalk/1.8.0/gitalk.css" integrity="sha256-AJnUHL7dBv6PGaeyPQJcgQPDjt/Hn/PvYZde1iqfp8U=" crossorigin="anonymous">

<script class="next-config" data-name="gitalk" type="application/json">{"enable":true,"github_id":"birdlet","repo":"birdlet.github.io","client_id":"0f3d8d5b00e8b378ccd0","client_secret":"049507faf0c3169f86f9e6e2c9422a32c24393b7","admin_user":"birdlet","distraction_free_mode":true,"proxy":"https://cors-anywhere.azm.workers.dev/https://github.com/login/oauth/access_token","language":"en","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/gitalk/1.8.0/gitalk.min.js","integrity":"sha256-MVK9MGD/XJaGyIghSVrONSnoXoGh3IFxLw0zfvzpxR4="},"path_md5":"537c54b4b2a07747a8a8fda4fc23ddb9"}</script>
<script src="/js/third-party/comments/gitalk.js"></script>

</body>
</html>
